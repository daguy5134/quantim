{% extends 'form.html' %}

{% set title = "Votre compte" %}
{% set fetch_destination = "/agenda" %}

{% block form_content %} 
<label for="username"><b> Votre username</b></label>
<input type="text" id="username" required disabled value="Loading..."><i class="material-icons edit_icon" onclick="document.location='change_username'" title="Modifier">&#xe254;</i>
<label for="email"><b> Votre adresse email </b></label>
<input type="email" id="email" required disabled value="Loading...">
<label for="email"><b> Votre mot de passe </b></label>
<input type="password" id="password" required disabled value="••••••••"><i class="material-icons edit_icon" onclick="document.location='change_password'" title="Modifier">&#xe254;</i>

<label for="accept_notif">
<input type="checkbox" name="accept_notif" id="accept_notif" style="margin-bottom:15px" checked> J'accepte de recevoir des emails
</label>
{% endblock %}
{% block script %}
<script>
const username = document.getElementById("username")
const email = document.getElementById("email")


const fetchProfile = async () => {
    try {
      const response = await fetch('/api/profile');

      if (!response.ok) throw new Error("Failed to fetch profile");

      const data = await response.json();

      // Bind API data to DOM
      username.value = data.username || "Unknown";
      email.value = data.email || "Unknown";
      // Password field always stays hidden
    } catch (err) {
      console.error("Error loading profile:", err);
      username.value = "Erreur";
      email.value = "Erreur";
    }
  };

  
const username_i = username.nextElementSibling
function edit_username(state){
  username_i.classList.toggle("hidden")
  if (state == "edit"){
    username.disabled = false
    username.focus()
  } else {
    username.disabled = true
    if (state == "save"){
      
    }
  }

}






  // Load when page starts
  window.addEventListener("DOMContentLoaded", fetchProfile);
</script>
{% endblock %}